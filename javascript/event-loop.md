# Event-Loop

说 Event-Loop 之前，先来谈谈javascript中几个问题：

1.  JS 为什么单线程？
2.  为什么需要异步?
3.  单线程有时如何实现异步的？

所谓任何技术引入都是有原因，其存在那么一定因什么而生；

> JS 为什么单线程？

JavaScript 的单线程，与它的用途有关。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。

```html
假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？
```

所以，为了避免复杂性，从一诞生，JavaScript就是单线程，这已经成了这门语言的核心特征，将来也不会改变。

> 为什么需要异步？

```html
假如在JS中不存在异步，只能自上而下执行，如果上一行代码解析时间很长（比如IO，请求远程数据）那么下面的代码就会被堵塞。对于用户而言，堵塞意味着"卡死"，这样导致了很差的用户体验。
```

> 单线程又是如何实现异步的 ?

通过 event-loop 来实现， 那么 event-loop 又是如何来处理的？

## 任务队列

------

单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。

```
任务1 -> 任务2 -> 任务3 -> 任务4 ...
```

来个现实生活例子： 去餐厅吃饭，一般大概流程排队，点餐，取饭菜； 假如现在排队有A，B，C，D人； 一般情况下是先来肯定先吃，但是也有一些特殊情况，比如B点的菜工序比较长（先煮半个小时，蒸半个小时），菜品复杂那么意味着耗时也会长； 如按照先来先吃原则，那等B做完才去做C，D的菜。估计C，D已经走了； 

上面显然这样是不合理的； 有没有更合理方式； 是不是可以正在做B菜时，同时做 C，D的菜； 这样减少 C，D等待时间同时最高效率利用厨师；











## 参考链接

[event-loop](http://www.ruanyifeng.com/blog/2014/10/event-loop.html)

[10分钟理解JS引擎的执行机制](https://segmentfault.com/a/1190000012806637)

[Eventloop的秘密](https://juejin.im/post/5b6d58fee51d45194b195544)

[浏览器 Javascript 的 EventLoop 动态图析](https://juejin.im/post/5b97d2b55188255c781ca228)				



任务队列

什么是任务 ?

同步任务： 在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；

异步任务：异步任务指的是，不进入主线程、而进入"任务队列"（task queue）的任务，只有"任务队列"通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。



